{% extends 'base.html' %}

{% block title %}Dashboard - Globo Frotas{% endblock %}

{% block content %}
<!-- Dashboard Header -->
<div class="dashboard-header">
    <h1><i class="fa-solid fa-gauge me-2"></i>Dashboard</h1>
    <p>Bem-vindo, <strong>{{ current_user.id }}</strong>! Aqui está um resumo das atividades operacionais.</p>
</div>

<!-- Estatísticas Rápidas - 3 Cards Principais -->
<div class="stats-grid">
    <button class="stat-card success" type="button" data-bs-toggle="collapse" data-bs-target="#veiculosDisponiveis"
        aria-expanded="false" aria-controls="veiculosDisponiveis">
        <div class="stat-icon">
            <i class="fa-solid fa-car"></i>
        </div>
        <div class="stat-value">{{ veiculos_disponiveis }}</div>
        <div class="stat-label">Veículos Disponíveis</div>
    </button>

    <button class="stat-card warning" type="button" data-bs-toggle="collapse" data-bs-target="#viagensEmRota"
        aria-expanded="false" aria-controls="viagensEmRota">
        <div class="stat-icon">
            <i class="fa-solid fa-road"></i>
        </div>
        <div class="stat-value">{{ viagens_em_rota }}</div>
        <div class="stat-label">Em Rota Agora</div>
    </button>

    <a href="{{ url_for('agendamentos') }}" class="stat-card info" style="text-decoration: none;">
        <div class="stat-icon">
            <i class="fa-solid fa-check-circle"></i>
        </div>
        <div class="stat-value">{{ viagens_hoje }}</div>
        <div class="stat-label">Viagens Hoje</div>
    </a>
</div>

<!-- Detalhes das métricas -->
<div class="row g-3 mb-4">
    <div class="col-12 col-xl-6">
        <div class="collapse" id="veiculosDisponiveis">
            <div class="content-section">
                <div class="section-title"><i class="fa-solid fa-car-side me-1"></i>Veículos disponíveis</div>
                <div class="table-responsive">
                    {% if veiculos_disponiveis_lista %}
                    <table class="table align-middle mb-0">
                        <thead>
                            <tr>
                                <th>Placa</th>
                                <th>Modelo</th>
                                <th>KM Atual</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for veiculo in veiculos_disponiveis_lista %}
                            <tr>
                                <td>{{ veiculo.placa }}</td>
                                <td>{{ veiculo.marca }} {{ veiculo.modelo }}</td>
                                <td>{{ '%.0f km' % veiculo.km_atual if veiculo.km_atual is not none else '—' }}</td>
                                <td><span class="badge bg-success">{{ veiculo.status }}</span></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                    <p class="text-muted mb-0">Nenhum veículo disponível no momento.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div class="col-12 col-xl-6">
        <div class="collapse" id="viagensEmRota">
            <div class="content-section">
                <div class="section-title"><i class="fa-solid fa-road me-1"></i>Viagens em rota</div>
                <div class="table-responsive">
                    {% if viagens_em_rota_lista %}
                    <table class="table align-middle mb-0">
                        <thead>
                            <tr>
                                <th>Placa</th>
                                <th>Motorista</th>
                                <th>Destino</th>
                                <th>Saída</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for viagem in viagens_em_rota_lista %}
                            <tr>
                                <td>{{ viagem.placa }}</td>
                                <td>{{ viagem.motorista.nome or viagem.motorista.id if viagem.motorista else 'N/D' }}
                                </td>
                                <td>{{ viagem.destino or '—' }}</td>
                                <td>{{ viagem.data_saida|format_date('%d/%m %H:%M') if viagem.data_saida else '—' }}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                    <p class="text-muted mb-0">Nenhuma viagem em rota agora.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Ações Rápidas -->
<div class="content-section">
    <div class="section-title">
        <i class="fa-solid fa-bolt"></i>Ações Rápidas
    </div>

    <div class="quick-actions">
        {% if current_user.role == 'admin' %}
        <a href="{{ url_for('registrar_saida') }}" class="quick-action-btn">
            <i class="fa-solid fa-arrow-right-from-bracket"></i>
            <span>Registrar Saída</span>
        </a>
        <a href="{{ url_for('registrar_chegada') }}" class="quick-action-btn">
            <i class="fa-solid fa-flag-checkered"></i>
            <span>Registrar Chegada</span>
        </a>
        {% endif %}
        <a href="{{ url_for('cronograma') }}" class="quick-action-btn">
            <i class="fa-solid fa-calendar"></i>
            <span>Ver Cronograma</span>
        </a>
        <a href="{{ url_for('agendar_veiculo') }}" class="quick-action-btn">
            <i class="fa-solid fa-calendar-plus"></i>
            <span>Agendar Veículo</span>
        </a>
        {% if current_user.role == 'admin' %}
        <a href="{{ url_for('relatorios') }}" class="quick-action-btn">
            <i class="fa-solid fa-chart-bar"></i>
            <span>Relatórios</span>
        </a>
        <a href="{{ url_for('gerenciar') }}" class="quick-action-btn">
            <i class="fa-solid fa-gear"></i>
            <span>Gerenciar</span>
        </a>
        {% endif %}
    </div>
</div>
{% endblock %}